#!/usr/bin/env node

var join = require('path').join;
var spawn = require('child_process').spawn;

/**
 * Args.
 */

var args = [join(__dirname, '_hermes')];

/**
 * Node flags.
 */

var flags = [
  '-d',
  'debug',
  '--debug',
  '--debug-brk',
  '-gc',
  '--expose-gc',
  '--gc-glocal',
  '--harmony',
  '--harmony-proxies',
  '--harmony-generators',
  '--prof',
  '--trace'
];

/**
 * Check for node flags and add them to the command.
 */

process.argv.slice(2).forEach(function(arg){
  ~flags.indexOf(arg)
    ? args.unshift(arg)
    : args.push(arg);
});

/**
 * Spawn.
 */

var child = spawn(process.argv[0], args, { customFds: [0,1,2] });

child.on('exit', function(code, signal){
  process.on('exit', function(){
    signal
      ? process.kill(process.pid, signal)
      : process.exit(code);
  });
});